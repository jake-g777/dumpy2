-- Check if the table exists
DECLARE
    table_exists NUMBER;
BEGIN
    SELECT COUNT(*) INTO table_exists
    FROM USER_TABLES
    WHERE TABLE_NAME = 'DUMPY_USERS';

    IF table_exists = 0 THEN
        -- Create the table
        EXECUTE IMMEDIATE '
            CREATE TABLE DUMPY_USERS (
                DUMPY_USERS_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
                FIREBASE_ID VARCHAR2(128) NOT NULL,
                USER_EMAIL VARCHAR2(255) NOT NULL,
                USER_ACCESS_LEVEL NUMBER DEFAULT 1,
                DISPLAY_NAME VARCHAR2(255),
                PHOTO_URL VARCHAR2(512),
                IS_EMAIL_VERIFIED NUMBER(1) DEFAULT 0,
                PHONE_NUMBER VARCHAR2(20),
                PROVIDER_ID VARCHAR2(50),
                CREATED_DATE TIMESTAMP DEFAULT SYSTIMESTAMP,
                LAST_LOGIN_DATE TIMESTAMP DEFAULT SYSTIMESTAMP,
                CONSTRAINT PK_DUMPY_USERS PRIMARY KEY (DUMPY_USERS_ID),
                CONSTRAINT UQ_DUMPY_USERS_EMAIL UNIQUE (USER_EMAIL),
                CONSTRAINT UQ_DUMPY_USERS_FIREBASE UNIQUE (FIREBASE_ID)
            )
        ';

        -- Create indexes
        EXECUTE IMMEDIATE 'CREATE INDEX IDX_DUMPY_USERS_EMAIL ON DUMPY_USERS(USER_EMAIL)';
        EXECUTE IMMEDIATE 'CREATE INDEX IDX_DUMPY_USERS_FIREBASE ON DUMPY_USERS(FIREBASE_ID)';
        
        DBMS_OUTPUT.PUT_LINE('DUMPY_USERS table created successfully');
    ELSE
        DBMS_OUTPUT.PUT_LINE('DUMPY_USERS table already exists');
    END IF;
END;
/ 